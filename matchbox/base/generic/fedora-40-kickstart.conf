# Generated by Anaconda 40.22.3
# Generated by pykickstart v3.52
#version=DEVEL
# Use text mode install
text --non-interactive
# Reboot after installation
reboot

%post
dnf makecache
mkdir -p /home/libvirt/lib
ln -s /home/libvirt/lib /var/lib/libvirt
chmod u+w /etc/sudoers
sed -i '/^%wheel/s;\(.\)ALL$;\1NOPASSWD: ALL;' /etc/sudoers
chmod u-w /etc/sudoers
update-crypto-policies --set DEFAULT:FEDORA32

%end

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device={{.net_device}} --hostname={{.domain_name}} --ipv6=auto --activate

# Use network installation
url --url="https://download.fedoraproject.org/pub/fedora/linux/releases/40/Server/x86_64/os/"

%packages
@^custom-environment
cockpit

%end

# Run the Setup Agent on first boot
firstboot --enable
# System services
services --disabled="kdump" --enabled="chronyd,cockpit.socket"
# Do not configure the X Window System
skipx

# Generated using Blivet version 3.9.1
ignoredisk --only-use={{.boot_drive}}
# Partition clearing information
clearpart --all --initlabel --drives={{.boot_drive}}
# Disk partitioning information
part /boot/efi --fstype="efi" --ondisk={{.boot_drive}} --size=600 --fsoptions="defaults,uid=0,gid=0,umask=077,shortname=winnt"
part /boot --fstype="xfs" --ondisk={{.boot_drive}} --size=1024
part pv.186 --fstype="lvmpv" --ondisk={{.boot_drive}} --size=952244
volgroup fedora_{{.server_name}} --pesize=4096 pv.186
logvol / --fstype="xfs" --size=51200 --name=root --vgname=fedora_{{.server_name}}
logvol /home --fstype="xfs" --grow --size=512000 --name=home --vgname=fedora_{{.server_name}}

# System timezone
timezone America/New_York --utc

#Root password
rootpw --lock
sshkey --username=gmarcy "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAsdgW20NtVSpXRSmC5cjEKTN+p9Ju01EdPYHdtwqmyp homelab@gmarcy.com"
user --groups=wheel --name=gmarcy --lock --gecos="Glenn Marcy"